import { PCDCrypto } from "./passportCrypto.js";
const sharedCryptoPromise = PCDCrypto.newInstance();
export async function getHash(str, cryptoPromise = sharedCryptoPromise) {
    const crypto = await cryptoPromise;
    const hashed = crypto.cryptoHash(str);
    return hashed;
}
export async function passportEncrypt(data, encryptionKey, cryptoPromise = sharedCryptoPromise) {
    const crypto = await cryptoPromise;
    const nonce = crypto.generateRandomKey(192);
    const ciphertext = crypto.xchacha20Encrypt(data, nonce, encryptionKey, "abc");
    return {
        nonce,
        ciphertext
    };
}
export async function passportDecrypt(encryptedStorage, encryptionKey, cryptoPromise = sharedCryptoPromise) {
    const crypto = await cryptoPromise;
    const plaintext = crypto.xchacha20Decrypt(encryptedStorage.ciphertext, encryptedStorage.nonce, encryptionKey, "abc");
    if (!plaintext) {
        throw new Error("could not decrypt storage");
    }
    return plaintext;
}
