"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.tryParse = exports.emptyStrToUndefined = exports.fmtDuration = exports.str = exports.flattenObject = exports.validateEmail = exports.normalizeEmail = void 0;
const email_validator_1 = __importDefault(require("email-validator"));
/**
 * Normalizes email so that equivalent emails can be compared.
 */
function normalizeEmail(email) {
    return email.toLowerCase().trim();
}
exports.normalizeEmail = normalizeEmail;
/**
 * Returns whether or not the parameter is an email address.
 */
function validateEmail(email) {
    return email_validator_1.default.validate(email);
}
exports.validateEmail = validateEmail;
/**
 * Converts `{ a: { b: "c" }, d: "e", f: { } }`
 * Into:
 * ```
 * [
 *   ["a.b": "c"],
 *   ["d": "3"]
 * ]
 * ```
 */
function flattenObject(obj) {
    if (obj === undefined || obj === null) {
        return [];
    }
    let res = [];
    for (const [k, v] of Object.entries(obj)) {
        if (typeof v === "string" || typeof v === "number") {
            res.push([k, v + ""]);
        }
        else {
            const flattenedChild = flattenObject(v).map(([ck, cv]) => [k + "." + ck, cv]);
            res = [...res, ...flattenedChild];
        }
    }
    return res;
}
exports.flattenObject = flattenObject;
/**
 * Shorthand for {@code JSON.stringify}
 */
function str(val) {
    return JSON.stringify(val, null, 2);
}
exports.str = str;
/**
 * Formats a duration of milliseconds into hh:mm:ss.
 */
function fmtDuration(totalMs) {
    const sec_num = Math.floor(totalMs / 1000);
    const hours = Math.floor(sec_num / 3600);
    const minutes = Math.floor((sec_num - hours * 3600) / 60);
    const seconds = sec_num - hours * 3600 - minutes * 60;
    let hoursFmt = hours + "";
    let minutesFmt = minutes + "";
    let secondsFmt = seconds + "";
    if (hours < 10) {
        hoursFmt = "0" + hours;
    }
    if (minutes < 10) {
        minutesFmt = "0" + minutes;
    }
    if (seconds < 10) {
        secondsFmt = "0" + seconds;
    }
    return hoursFmt + ":" + minutesFmt + ":" + secondsFmt;
}
exports.fmtDuration = fmtDuration;
/**
 * Converts an empty string to undefined, while passing other argument
 * values through unmodified.
 */
function emptyStrToUndefined(inStr) {
    if (inStr === "") {
        return undefined;
    }
    return inStr;
}
exports.emptyStrToUndefined = emptyStrToUndefined;
function tryParse(str) {
    try {
        return JSON.parse(str);
    }
    catch {
        return undefined;
    }
}
exports.tryParse = tryParse;
